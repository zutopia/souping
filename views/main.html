<!DOCTYPE html>
<html>
  <head>
    <title><%= key %>(搜评)</title>
    <%- partial('common') %>
  </head>
  <body>
  	<div class="container">
		<div style="margin:1% 0% 3% 0%;">
			<div class="row">
				<div class="col-md-1">
					<a href="/"><label style="font-size:32px;font-family:Microsoft YaHei;color:#3388FF;cursor:pointer">搜评</label></a>
				</div>
				<div class="col-lg-5">
					<form role="form" action="/main">
				    	<div class="input-group">
				    			<%  if (typeof(key) !== 'undefined' && key !== null)  { %>
						    		<input type="text" class="form-control input-lg" id="key" maxlength="100" value="<%= key %>" >
						    	<%  } else { %>
						    		<input type="text" class="form-control input-lg" id="key" maxlength="100" >
						    	<% } %>	
						      <span class="input-group-btn">
						        	<button class="btn btn-primary btn-lg" id="submit" onclick="search()">
						        		&nbsp;<span class="glyphicon glyphicon-search"></span>&nbsp;
						        	</button>
						      </span>
				    	</div><!-- /input-group -->
				    </form>
				</div><!-- /.col-lg-6 -->
				<div class="col-md-3" style="margin-top:-2%;min-height:90px;">
					<img id="loading" style="display:none;" width="120px" height="90px" src="/images/loading.gif">
				</div>
			</div><!-- /.row -->
		</div>

		<% if (typeof(list) !== 'undefined' && list.length > 0) { %>
			<% list.forEach(function (v, k){ %>
				<div class="media">
				  <div class="media-body">
				  	<h4 class="media-heading">
				  		<a href="/detail?id=<%= v.id %>" data-toggle="popover" onmouseover="showPop('<%= v.id %>','<%= v.img %>','<%= k %>')"  onmouseout="hidePop('<%= v.id %>')" id="<%= v.id %>" target="_blank"><%= v.title %>(<%= v.year %>)</a>
				  	</h4>
				  	<b>豆瓣评分：</b><b style="color:#C7254E;"><%= v.score %></b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				  	<b>类型：</b><% if (v.subtype === 'tv') { %>
				  		连续剧
				  	<%  } else { %>
				  		电影
				  	<% } %>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				  	<b>原始名：</b><%= v.org_title %>
				  	<br>
				  	<b>导演：</b><%= v.directors %>
				  	<br>
				  	<b>主演：</b><%= v.casts %>
				  	<br>
				  	<b>影片类型：</b><%= v.genres %>
				  </div>
				</div>
				<br>
			<% })%>
		<% } %> 
	</div>

  </body>
</html>
<script type="text/javascript">

//判断浏览器 
var Browser=new Object(); 
Browser.userAgent=window.navigator.userAgent.toLowerCase(); 
Browser.ie=/msie/.test(Browser.userAgent); 
Browser.Moz=/gecko/.test(Browser.userAgent); 
//判断是否加载完成 
function Imagess(url,obj,callback){    
    var val=url; 
    var img=new Image(); 
    if(Browser.ie){ 
        img.onreadystatechange =function(){  
            if(img.readyState=="complete"||img.readyState=="loaded"){ 
                callback(img,obj); 
            } 
        }        
    }else if(Browser.Moz){ 
        img.onload=function(){ 
            if(img.complete==true){ 
                callback(img,obj); 
            } 
        }        
    }    
    //如果因为网络或图片的原因发生异常，则显示该图片 
    //img.onerror=function(){img.src='http://www.baidu.com/img/baidu_logo.gif'} 
    img.src=val; 
} 
//显示图片 
function checkimg(obj,obj2){ 
//	$(obj2).css('margin-top','0px');
	$(obj2).animate({width:'160',height:'230'});
//	$(obj2).attr('width',160);
//	$(obj2).attr('height',230);
	$(obj2).attr('src',obj.src); 
} 

function showPop(id,imgurl,order){
	var placement = 'right';
	$('#'+id).popover({
		placement:placement,
		html:true,
		//content:'<div style="width:160px;height:230px;text-align:center;" ><img style="margin-top:100px;" id="img_'+id+'" width="25" height="25" src="/images/loading3.gif"></div>'
		//content:'<img  id="img_'+id+'" width="120" height="90" src="/images/loading2.gif">'
		content:'<img  id="img_'+id+'" width="25" height="25" src="/images/loading3.gif">'
	})
	$('#'+id).popover('show');
	Imagess(imgurl,$('#img_'+id),checkimg);
}

function hidePop(id){
	$('#'+id).popover('hide');
}
</script>

